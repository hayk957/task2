<?php

if (session_status() == PHP_SESSION_NONE) {
  session_start();
}


class Jobs extends Dbh
{

    public function __construct()
    {

    }

    public function getTeams()
  {
      $db = new Dbh();
      $conn = $db->connect();
      $sql = "SELECT * FROM jobcategories";
      $result = $conn->query($sql)->fetchAll();
      $categories="";
      foreach ($result as $value) {
      $categories.='<li value="'.$value['categoryid'].'">'.$value['category']. '</li>';
      }
      return '<li class="current">All</li>'.$categories ;
  }

  public function getDateDiff($totime, $fromtime)
  {
    $diff = strtotime($totime) - strtotime($fromtime);
    $diff = gmdate('H:i', $diff) . " hour(s).";
    return $diff;
  }


  public function getOpenJobs($status)
  {
    // TODO SELECT and get summary count of `persons` and `persons_found` columns from `jobs` table based on $status variable

      $db = new Dbh;
      $conn = $db->connect();
      $sql = "SELECT SUM(persons) AS sum_persons,SUM(persons_found) AS sum_persons_found FROM jobs WHERE completed = $status";
      $result = $conn->query($sql)->fetch();
      echo "<div><br>friends needed: ".$result['sum_persons']."<br>friends found: ".$result['sum_persons_found']."</div>";
  }


  public function setJob()
  {
    echo '<div class="post-edit__body"><form id="post_insert" method="post">
          <div class="post-edit__el-container post-edit__el-container--title">
            <svg
              width="15"
              height="15"
              viewBox="0 0 15 15"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M14.5755 3.75781C14.5208 3.51172 14.22 3.42969 14.0286 3.59375L12.0051 5.61719L10.1458 5.31641L9.84499 3.45703L11.8684 1.43359C12.0598 1.24219 11.9505 0.941406 11.7044 0.886719C10.4192 0.558594 8.99734 0.914062 7.98562 1.92578C6.89187 2.99219 6.59109 4.57812 7.05593 5.94531L1.20437 11.7695C0.520773 12.4531 0.520773 13.5742 1.20437 14.2578C1.88796 14.9414 3.00905 14.9414 3.69265 14.2578L9.51687 8.43359C10.8841 8.87109 12.4426 8.57031 13.5364 7.47656C14.5481 6.46484 14.9036 5.04297 14.5755 3.75781ZM2.46218 13.6562C2.07937 13.6562 1.80593 13.3828 1.80593 13C1.80593 12.6445 2.07937 12.3438 2.46218 12.3438C2.81765 12.3438 3.11843 12.6445 3.11843 13C3.11843 13.3828 2.81765 13.6562 2.46218 13.6562Z"
                fill="#FD6060"
              />
            </svg>
            <input type="hidden" name="post-edit-id"/>
            <input
              class="input font-3"
              name="post-edit-title"
              type="text"
              placeholder="job name goes here!"
            />
          </div>

          <div class="post-edit__el-container post-edit__el-container--hand">
            <div class="d-flex align-center">
              <svg
                width="13"
                height="15"
                viewBox="0 0 13 15"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M11.4366 4.27734C10.835 4.25 10.3428 4.76953 10.3428 5.37109V7.75H10.1241V2.9375C10.1241 2.33594 9.60456 1.81641 9.00299 1.84375C8.40143 1.84375 7.93659 2.33594 7.93659 2.91016V7.75H7.71784V1.87109C7.71784 1.26953 7.19831 0.75 6.59674 0.777344C5.99518 0.777344 5.53034 1.26953 5.53034 1.84375V7.75H5.31159V2.96484C5.31159 2.36328 4.79206 1.84375 4.19049 1.87109C3.58893 1.87109 3.12409 2.36328 3.12409 2.9375V9.39062L2.24909 8.21484C1.89362 7.72266 1.21003 7.61328 0.717838 7.96875C0.225651 8.32422 0.116276 9.00781 0.471745 9.5L3.91706 14.2305C4.13581 14.5312 4.60065 14.75 4.98346 14.75H10.3702C10.9717 14.75 11.5186 14.3398 11.6553 13.7383L12.3663 10.6758C12.4483 10.3477 12.503 9.80078 12.503 9.47266V5.34375C12.5303 4.76953 12.0382 4.27734 11.4366 4.27734Z"
                  fill="#FD6060"
                />
              </svg>
              <div id="post-edit-hand" class="d-flex align-center">
                <input name="post-edit-hand" class="input font-3" type="text" placeholder="0" />
                <button type="button" class="font-6">+</button>
                <button type="button" class="font-6">-</button>
              </div>
            </div>

            <div>
              <label class="checkbox-button">
                <input type="checkbox" name="post-edit-urgent" class="checkbox-button__input" />
                <span class="checkbox-button__control checkbox-button__control--dashbord">
                  <svg
                    width="15"
                    height="11"
                    viewBox="0 0 15 11"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M5.12214 10.7812C5.39557 11.0547 5.86042 11.0547 6.13385 10.7812L14.1729 2.74219C14.4464 2.46875 14.4464 2.00391 14.1729 1.73047L13.1885 0.746094C12.9151 0.472656 12.4776 0.472656 12.2042 0.746094L5.64167 7.30859L2.55182 4.24609C2.27839 3.97266 1.84089 3.97266 1.56745 4.24609L0.583073 5.23047C0.309635 5.50391 0.309635 5.96875 0.583073 6.24219L5.12214 10.7812Z"
                      fill="white"
                    />
                  </svg>
                </span>
                <span class="checkbox-button__label font-5">This job is urgent</span>
              </label>
            </div>
          </div>
          <div class="post-edit__el-container post-edit__el-container--team">
            <svg
              width="19"
              height="15"
              viewBox="0 0 19 15"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M14.1298 6.2981L8.36027 0.528564C8.14152 0.309814 7.73136 0.118408 7.43058 0.118408H1.85245C1.11417 0.118408 0.539953 0.719971 0.539953 1.43091V7.03638C0.539953 7.33716 0.704016 7.74731 0.922766 7.96606L6.6923 13.7356C7.21183 14.2551 8.05948 14.2551 8.55167 13.7356L14.1298 8.15747C14.6493 7.66528 14.6493 6.81763 14.1298 6.2981ZM3.60245 4.49341C2.86417 4.49341 2.28995 3.91919 2.28995 3.18091C2.28995 2.46997 2.86417 1.86841 3.60245 1.86841C4.31339 1.86841 4.91495 2.46997 4.91495 3.18091C4.91495 3.91919 4.31339 4.49341 3.60245 4.49341ZM17.6298 8.15747C18.1493 7.66528 18.1493 6.81763 17.6298 6.2981L11.8603 0.528564C11.6415 0.309814 11.2314 0.118408 10.9306 0.118408H9.59073L14.9501 5.50513C15.415 5.96997 15.6884 6.57153 15.6884 7.22778C15.6884 7.88403 15.415 8.51294 14.9501 8.97778L10.1923 13.7356C10.7118 14.2551 11.5595 14.2551 12.0517 13.7356L17.6298 8.15747Z"
                fill="#FD6060"
              />
            </svg>
            <div id="popup-comm-select" class="custom-select">
              <span>All</span>
              <ul>' . $this->getTeams() . '</ul>
            </div>
          </div>
          <div class="post-edit__el-container post-edit__el-container--clock">
            <svg
              width="15"
              height="15"
              viewBox="0 0 15 15"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M7.66944 0.96875C3.92335 0.96875 0.888194 4.00391 0.888194 7.75C0.888194 11.4961 3.92335 14.5312 7.66944 14.5312C11.4155 14.5312 14.4507 11.4961 14.4507 7.75C14.4507 4.00391 11.4155 0.96875 7.66944 0.96875ZM9.22804 10.5664L6.79444 8.78906C6.71241 8.73438 6.68507 8.65234 6.68507 8.54297V3.92188C6.68507 3.75781 6.82179 3.59375 7.01319 3.59375H8.32569C8.48976 3.59375 8.65382 3.75781 8.65382 3.92188V7.69531L10.3765 8.95312C10.5132 9.0625 10.5679 9.28125 10.4585 9.41797L9.66554 10.4844C9.58351 10.6211 9.36476 10.6484 9.22804 10.5664Z"
                fill="#FD6060"
              />
            </svg>

            <div class="datetimepicker-wrapper">
              <input
                id="datetimepicker1"
                class="post-edit__timedatepicker input font-3 date noEnterSubmit"
                name="post-edit-date"
                type="text"
              />
            </div>

            <input
              id="timepicker1"
              class="post-edit__timepicker input font-3 time noEnterSubmit"
              name="post-edit-from"
              type="text"
            />
            <span class="de font-2">-</span>
            <input
              id="timepicker2"
              class="post-edit__timepicker input font-3 time noEnterSubmit"
              name="post-edit-to"
              type="text"
            />
          </div>

          <div class="post-edit__el-container post-edit__el-container--check">
            <svg
              width="10"
              height="17"
              viewBox="0 0 10 17"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M3.89167 9.90625V14.8125L4.57917 15.8438C4.70417 16.0625 5.04792 16.0625 5.17292 15.8438L5.89167 14.8125V9.90625C5.54792 9.96875 5.20417 10 4.89167 10C4.54792 10 4.20417 9.96875 3.89167 9.90625ZM4.89167 0C2.39167 0 0.391666 2.03125 0.391666 4.5C0.391666 7 2.39167 9 4.89167 9C7.36042 9 9.39167 7 9.39167 4.5C9.39167 2.03125 7.36042 0 4.89167 0ZM4.89167 2.375C3.70417 2.375 2.76667 3.34375 2.76667 4.5C2.76667 4.71875 2.57917 4.875 2.39167 4.875C2.17292 4.875 2.01667 4.71875 2.01667 4.5C2.01667 2.9375 3.29792 1.625 4.89167 1.625C5.07917 1.625 5.26667 1.8125 5.26667 2C5.26667 2.21875 5.07917 2.375 4.89167 2.375Z"
                fill="#FD6060"
              />
            </svg>

            <label class="checkbox-button">
              <input type="checkbox" name="post-edit-active"  class="checkbox-button__input" />
              <span class="checkbox-button__control checkbox-button__control--dashbord">
                <svg
                  width="15"
                  height="11"
                  viewBox="0 0 15 11"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M5.12214 10.7812C5.39557 11.0547 5.86042 11.0547 6.13385 10.7812L14.1729 2.74219C14.4464 2.46875 14.4464 2.00391 14.1729 1.73047L13.1885 0.746094C12.9151 0.472656 12.4776 0.472656 12.2042 0.746094L5.64167 7.30859L2.55182 4.24609C2.27839 3.97266 1.84089 3.97266 1.56745 4.24609L0.583073 5.23047C0.309635 5.50391 0.309635 5.96875 0.583073 6.24219L5.12214 10.7812Z"
                    fill="white"
                  />
                </svg>
              </span>
              <span class="checkbox-button__label font-5">Active</span>
            </label>
          </div>
          <div class="post-edit__el-container post-edit__el-container--title">
            <svg
              width="12"
              height="15"
              viewBox="0 0 12 15"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M5.20809 14.4766C5.45419 14.8594 6.02841 14.8594 6.2745 14.4766C10.2667 8.73438 11.005 8.13281 11.005 6C11.005 3.10156 8.65341 0.75 5.75497 0.75C2.82919 0.75 0.50497 3.10156 0.50497 6C0.50497 8.13281 1.21591 8.73438 5.20809 14.4766ZM5.75497 8.1875C4.5245 8.1875 3.56747 7.23047 3.56747 6C3.56747 4.79688 4.5245 3.8125 5.75497 3.8125C6.95809 3.8125 7.94247 4.79688 7.94247 6C7.94247 7.23047 6.95809 8.1875 5.75497 8.1875Z"
                fill="#FD6060"
              />
            </svg>
            <input
              class="input font-3"
              name="post-edit-meetPlace"
              type="text"
              placeholder="where should people meet?"
            />
          </div>
           <div class="post-edit__el-container post-edit__el-container--title">
            <svg
              width="15"
              height="15"
              viewBox="0 0 15 15"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M7.66944 0.96875C3.92335 0.96875 0.888194 4.00391 0.888194 7.75C0.888194 11.4961 3.92335 14.5312 7.66944 14.5312C11.4155 14.5312 14.4507 11.4961 14.4507 7.75C14.4507 4.00391 11.4155 0.96875 7.66944 0.96875ZM9.22804 10.5664L6.79444 8.78906C6.71241 8.73438 6.68507 8.65234 6.68507 8.54297V3.92188C6.68507 3.75781 6.82179 3.59375 7.01319 3.59375H8.32569C8.48976 3.59375 8.65382 3.75781 8.65382 3.92188V7.69531L10.3765 8.95312C10.5132 9.0625 10.5679 9.28125 10.4585 9.41797L9.66554 10.4844C9.58351 10.6211 9.36476 10.6484 9.22804 10.5664Z"
                fill="#FD6060"
              />
            </svg>
            <input
              class="input font-3"
              name="post-edit-meetTime"
              type="text"
              placeholder="when should people meet?"
            />
          </div>
          
          <div class="post-edit__el-container post-edit__el-container--title">
            <svg xmlns="http://www.w3.org/2000/svg" 
              width="15"
              height="15"
              viewBox="0 0 300 300">
          	<path d="M175,171.173c38.914,0,70.463-38.318,70.463-85.586C245.463,38.318,235.105,0,175,0s-70.465,38.318-70.465,85.587
          	C104.535,132.855,136.084,171.173,175,171.173z" fill="#FD6060"/>
          	<path d="M41.909,301.853C41.897,298.971,41.885,301.041,41.909,301.853L41.909,301.853z" fill="#FD6060"/>
          	<path d="M308.085,304.104C308.123,303.315,308.098,298.63,308.085,304.104L308.085,304.104z" fill="#FD6060"/>
          	<path d="M307.935,298.397c-1.305-82.342-12.059-105.805-94.352-120.657c0,0-11.584,14.761-38.584,14.761
          	s-38.586-14.761-38.586-14.761c-81.395,14.69-92.803,37.805-94.303,117.982c-0.123,6.547-0.18,6.891-0.202,6.131
          	c0.005,1.424,0.011,4.058,0.011,8.651c0,0,19.592,39.496,133.08,39.496c113.486,0,133.08-39.496,133.08-39.496
          	c0-2.951,0.002-5.003,0.005-6.399C308.062,304.575,308.018,303.664,307.935,298.397z" fill="#FD6060"/>
          	</svg>
            <input
              class="input font-3"
              name="post-edit-contactPerson"
              type="text"
              placeholder="contact person"
            />
          </div>

          <div class="post-edit__footer">
            <button type="button" id="post-edit__close" class="button button-tr">
              <svg
                width="6"
                height="9"
                viewBox="0 0 6 9"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M4.50177 8.56059C4.81137 8.83576 5.28543 8.80784 5.56059 8.49823C5.83576 8.18863 5.80784 7.71457 5.49823 7.43941L4.50177 8.56059ZM1 4.44495L0.531929 3.85894C0.359147 3.99695 0.256074 4.20418 0.250259 4.42523C0.244444 4.64629 0.336479 4.85865 0.501767 5.00555L1 4.44495ZM5.46807 1.83601C5.79172 1.5775 5.84452 1.10557 5.58601 0.781929C5.3275 0.458284 4.85558 0.405479 4.53193 0.663988L5.46807 1.83601ZM5.49823 7.43941L1.49823 3.88436L0.501767 5.00555L4.50177 8.56059L5.49823 7.43941ZM1.46807 5.03097L5.46807 1.83601L4.53193 0.663988L0.531929 3.85894L1.46807 5.03097Z"
                  fill="#3D3636"
                  fill-opacity="0.6"
                />
              </svg>
              back
            </button>
            <button id="post-edit__edit" name="editjob" class="button button-dashboard hidden">edit</button>
            <button id="post-edit__create" name="createjob" class="button button-dashboard">post</button>
            
          </div>
          </form>
        </div>';
  }

  public function getAllJobs()
  {
      $db = new Dbh;
      $conn = $db->connect();
      $sql = "SELECT jobs.*,jobcategories.category FROM jobs LEFT JOIN jobcategories ON jobs.jobcategoryid = jobcategories.categoryid WHERE completed = 0 ORDER BY  timeto DESC ";
      $result = $conn->query($sql)->fetchAll();

      // TODO check and add $urgent class
      // TODO Organize SELECT from `jobs` and `jobcategories` tables based on completed column

      foreach ($result as $job){

          $job_id = $job['jobid'];
          $category_id = $job['jobcategoryid'];
          $job_name =$job['jobname'];
          $persons_count = $job['persons'];
          $location = $job['location'];
          $category = $job['category'];
          $period = $job['period'];
          $contactPerson = $job['contactperson'];
          $time_from = gmdate("H:i. l, F j",strtotime($job['timefrom']));
          $diff = gmdate("H:i",strtotime($job['timeto'])-strtotime($job['timefrom']));
          $persons_found = $job['persons_found'];
            if ($job['urgent']==1) {
                $urgent = "job-item__wrapper--urgent";
            } else {
                $urgent = "";
            }


          echo
      '<div class="col-12 col-sm-6	col-md-6 col-lg-4	col-xl-3">

              <section class="job-item__wrapper ' . $urgent . '"> 
                <span class="job-item__repeat"
                  ><svg
                    width="10"
                    height="16"
                    viewBox="0 0 10 16"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M3.89167 9.90625V14.8125L4.57917 15.8438C4.6625 15.9479 4.76667 16 4.89167 16C5.01667 16 5.12083 15.9479 5.20417 15.8438L5.89167 14.8125V9.90625C5.5375 9.96875 5.20417 10 4.89167 10C4.57917 10 4.24583 9.96875 3.89167 9.90625ZM4.89167 0C4.07917 0 3.32917 0.208333 2.64167 0.625C1.95417 1.02083 1.40208 1.5625 0.985416 2.25C0.589583 2.9375 0.391666 3.6875 0.391666 4.5C0.391666 5.3125 0.589583 6.0625 0.985416 6.75C1.40208 7.4375 1.95417 7.98958 2.64167 8.40625C3.32917 8.80208 4.07917 9 4.89167 9C5.70417 9 6.45417 8.80208 7.14167 8.40625C7.82917 7.98958 8.37083 7.4375 8.76667 6.75C9.18333 6.0625 9.39167 5.3125 9.39167 4.5C9.39167 3.6875 9.18333 2.9375 8.76667 2.25C8.37083 1.5625 7.82917 1.02083 7.14167 0.625C6.45417 0.208333 5.70417 0 4.89167 0ZM4.89167 2.375C4.30833 2.375 3.80833 2.58333 3.39167 3C2.975 3.41667 2.76667 3.91667 2.76667 4.5C2.76667 4.60417 2.725 4.69792 2.64167 4.78125C2.57917 4.84375 2.49583 4.875 2.39167 4.875C2.2875 4.875 2.19375 4.84375 2.11042 4.78125C2.04792 4.69792 2.01667 4.60417 2.01667 4.5C2.01667 3.70833 2.29792 3.03125 2.86042 2.46875C3.42292 1.90625 4.1 1.625 4.89167 1.625C4.99583 1.625 5.07917 1.66667 5.14167 1.75C5.225 1.8125 5.26667 1.89583 5.26667 2C5.26667 2.10417 5.225 2.19792 5.14167 2.28125C5.07917 2.34375 4.99583 2.375 4.89167 2.375Z"
                      fill="#FD6060"
                    />
                  </svg>
                </span>
                <header>
                  <svg
                    class="job-item__edb"
                    width="15"
                    height="15"
                    viewBox="0 0 15 15"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M14.7823 3.73047C14.7458 3.60286 14.6638 3.52995 14.5362 3.51172C14.4268 3.47526 14.3266 3.5026 14.2354 3.59375L12.1846 5.61719L10.3253 5.31641L10.0245 3.45703L12.0479 1.40625C12.1391 1.3151 12.1664 1.21484 12.1299 1.10547C12.1117 0.977865 12.0388 0.895833 11.9112 0.859375C11.2549 0.695312 10.5896 0.704427 9.9151 0.886719C9.24062 1.06901 8.65729 1.40625 8.1651 1.89844C7.63646 2.42708 7.2901 3.05599 7.12604 3.78516C6.96198 4.51432 6.99844 5.22526 7.23542 5.91797L1.4112 11.7695C1.06484 12.1159 0.891666 12.526 0.891666 13C0.891666 13.4922 1.05573 13.9023 1.38385 14.2305C1.73021 14.5768 2.14036 14.75 2.61432 14.75C3.10651 14.75 3.52578 14.5768 3.87214 14.2305L9.69635 8.40625C10.4073 8.64323 11.1182 8.67969 11.8292 8.51562C12.5583 8.35156 13.1964 8.00521 13.7432 7.47656C14.2354 6.96615 14.5727 6.38281 14.7549 5.72656C14.9372 5.05208 14.9464 4.38672 14.7823 3.73047ZM2.64167 13.6562C2.45937 13.6562 2.30443 13.5924 2.17682 13.4648C2.04922 13.3372 1.98542 13.1823 1.98542 13C1.98542 12.8177 2.04922 12.6628 2.17682 12.5352C2.30443 12.4076 2.45937 12.3438 2.64167 12.3438C2.82396 12.3438 2.97891 12.4076 3.10651 12.5352C3.23411 12.6628 3.29792 12.8177 3.29792 13C3.29792 13.1823 3.23411 13.3372 3.10651 13.4648C2.97891 13.5924 2.82396 13.6562 2.64167 13.6562Z"
                      fill="#FD6060"
                    />
                  </svg>
                  <p class="job-item__title font-7">'.$job_name.'</p>
                  <p class="job-item__id hidden">'.$job_id.'</p>
                  <p class="job-item__meet-place hidden">'.$location.'</p>
                  <p class="job-item__meet-time hidden">'.$period.'</p>
                  <p class="job-item__contact-person hidden">'.$contactPerson.'</p>
                </header>
                <section class="job-item">
                  <ul>
                    <li>
                      <svg
                        width="14"
                        height="15"
                        viewBox="0 0 14 15"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <path
                          d="M12.1836 4.25C11.8737 4.25 11.6094 4.35938 11.3906 4.57812C11.1719 4.79688 11.0625 5.0612 11.0625 5.37109V7.75H10.8438V2.9375C10.8438 2.6276 10.7344 2.36328 10.5156 2.14453C10.2969 1.92578 10.0326 1.81641 9.72266 1.81641C9.43099 1.81641 9.17578 1.92578 8.95703 2.14453C8.75651 2.36328 8.65625 2.61849 8.65625 2.91016V7.75H8.4375V1.87109C8.4375 1.5612 8.32812 1.29688 8.10938 1.07812C7.89062 0.859375 7.6263 0.75 7.31641 0.75C7.02474 0.75 6.76953 0.859375 6.55078 1.07812C6.35026 1.29688 6.25 1.55208 6.25 1.84375V7.75H6.03125V2.96484C6.03125 2.65495 5.92188 2.39062 5.70312 2.17188C5.48438 1.95312 5.22005 1.84375 4.91016 1.84375C4.61849 1.84375 4.36328 1.95312 4.14453 2.17188C3.94401 2.39062 3.84375 2.64583 3.84375 2.9375V9.39062L2.96875 8.1875C2.80469 7.95052 2.56771 7.8138 2.25781 7.77734C1.96615 7.72266 1.69271 7.78646 1.4375 7.96875C1.20052 8.13281 1.05469 8.36979 1 8.67969C0.963542 8.97135 1.03646 9.24479 1.21875 9.5L4.63672 14.2031C4.76432 14.3854 4.91927 14.5221 5.10156 14.6133C5.30208 14.7044 5.5026 14.75 5.70312 14.75H11.1172C11.4089 14.75 11.6732 14.6497 11.9102 14.4492C12.1654 14.2669 12.3203 14.0299 12.375 13.7383L13.1133 10.6484C13.2044 10.2656 13.25 9.86458 13.25 9.44531V5.34375C13.25 5.05208 13.1406 4.79688 12.9219 4.57812C12.7214 4.35938 12.4753 4.25 12.1836 4.25Z"
                          fill="#FD6060"
                        />
                      </svg>
                      <span class="job-item__hand font-5">'.$persons_count.'</span>&nbsp;<span class="font-5">registered: '.$persons_found.'</span>
                    </li>
                    <li>
                      <svg
                        width="18"
                        height="15"
                        viewBox="0 0 18 15"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <path
                          d="M13.6172 6.92969L7.82031 1.13281C7.5651 0.877604 7.25521 0.75 6.89062 0.75H1.3125C0.947917 0.75 0.638021 0.877604 0.382812 1.13281C0.127604 1.38802 0 1.69792 0 2.0625V7.64062C0 8.00521 0.127604 8.3151 0.382812 8.57031L6.17969 14.3672C6.4349 14.6224 6.74479 14.75 7.10938 14.75C7.47396 14.75 7.78385 14.6224 8.03906 14.3672L13.6172 8.78906C13.8724 8.53385 14 8.22396 14 7.85938C14 7.49479 13.8724 7.1849 13.6172 6.92969ZM3.0625 5.125C2.69792 5.125 2.38802 4.9974 2.13281 4.74219C1.8776 4.48698 1.75 4.17708 1.75 3.8125C1.75 3.44792 1.8776 3.13802 2.13281 2.88281C2.38802 2.6276 2.69792 2.5 3.0625 2.5C3.42708 2.5 3.73698 2.6276 3.99219 2.88281C4.2474 3.13802 4.375 3.44792 4.375 3.8125C4.375 4.17708 4.2474 4.48698 3.99219 4.74219C3.73698 4.9974 3.42708 5.125 3.0625 5.125ZM17.1172 8.78906L11.5391 14.3672C11.2839 14.6224 10.974 14.75 10.6094 14.75C10.2448 14.75 9.9349 14.6224 9.67969 14.3672L14.4375 9.60938C14.9115 9.11719 15.1484 8.53385 15.1484 7.85938C15.1484 7.1849 14.9115 6.60156 14.4375 6.10938L9.05078 0.75H10.3906C10.7552 0.75 11.0651 0.877604 11.3203 1.13281L17.1172 6.92969C17.3724 7.1849 17.5 7.49479 17.5 7.85938C17.5 8.22396 17.3724 8.53385 17.1172 8.78906Z"
                          fill="#FD6060"
                        />
                      </svg>
                      <span class="job-item__team font-5">'.$category.'<input name="post-edit-categoryId" class="hidden" value="'.$category_id.'"/>
                      </span>
                    </li>
                    <li>
                      <svg
                        width="14"
                        height="15"
                        viewBox="0 0 14 15"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <path
                          d="M7 0.96875C5.77865 0.96875 4.64844 1.27865 3.60938 1.89844C2.57031 2.5 1.74089 3.32031 1.12109 4.35938C0.519531 5.39844 0.21875 6.52865 0.21875 7.75C0.21875 8.97135 0.519531 10.1016 1.12109 11.1406C1.74089 12.1797 2.57031 13 3.60938 13.6016C4.64844 14.2214 5.77865 14.5312 7 14.5312C8.22135 14.5312 9.35156 14.2214 10.3906 13.6016C11.4297 13 12.25 12.1797 12.8516 11.1406C13.4714 10.1016 13.7812 8.97135 13.7812 7.75C13.7812 6.52865 13.4714 5.39844 12.8516 4.35938C12.25 3.32031 11.4297 2.5 10.3906 1.89844C9.35156 1.27865 8.22135 0.96875 7 0.96875ZM8.55859 10.5391L6.15234 8.78906C6.0612 8.71615 6.01562 8.625 6.01562 8.51562V3.92188C6.01562 3.83073 6.04297 3.75781 6.09766 3.70312C6.17057 3.63021 6.2526 3.59375 6.34375 3.59375H7.65625C7.7474 3.59375 7.82031 3.63021 7.875 3.70312C7.94792 3.75781 7.98438 3.83073 7.98438 3.92188V7.69531L9.73438 8.95312C9.80729 9.00781 9.84375 9.08073 9.84375 9.17188C9.86198 9.26302 9.84375 9.34505 9.78906 9.41797L9.02344 10.457C8.96875 10.5299 8.89583 10.5755 8.80469 10.5938C8.71354 10.612 8.63151 10.5938 8.55859 10.5391Z"
                          fill="#FD6060"
                        />
                      </svg>
                      <span class="job-item__date font-5">'.$time_from.''.'</span>
                      <span class="job-item__date_full hidden">'.$time_from.'</span>
                    </li>
                    <li>
                      <svg
                        width="12"
                        height="15"
                        viewBox="0 0 12 15"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <path
                          d="M11.8125 9.0625C11.8125 10.1016 11.5573 11.0586 11.0469 11.9336C10.5365 12.7904 9.84375 13.474 8.96875 13.9844C8.11198 14.4948 7.16406 14.75 6.125 14.75C5.08594 14.75 4.12891 14.4948 3.25391 13.9844C2.39714 13.474 1.71354 12.7904 1.20312 11.9336C0.692708 11.0586 0.4375 10.1016 0.4375 9.0625C0.4375 8.13281 0.647135 7.26693 1.06641 6.46484C1.48568 5.64453 2.0599 4.97005 2.78906 4.44141C3.53646 3.91276 4.35677 3.58464 5.25 3.45703V2.5H4.48438C4.39323 2.5 4.3112 2.47266 4.23828 2.41797C4.18359 2.34505 4.15625 2.26302 4.15625 2.17188V1.07812C4.15625 0.986979 4.18359 0.914062 4.23828 0.859375C4.3112 0.786458 4.39323 0.75 4.48438 0.75H7.76562C7.85677 0.75 7.92969 0.786458 7.98438 0.859375C8.05729 0.914062 8.09375 0.986979 8.09375 1.07812V2.17188C8.09375 2.26302 8.05729 2.34505 7.98438 2.41797C7.92969 2.47266 7.85677 2.5 7.76562 2.5H7V3.42969C8.02083 3.59375 8.93229 4.00391 9.73438 4.66016L10.4727 3.92188C10.5456 3.84896 10.6276 3.8125 10.7188 3.8125C10.8099 3.8125 10.8828 3.84896 10.9375 3.92188L11.7305 4.6875C11.7852 4.74219 11.8125 4.8151 11.8125 4.90625C11.8125 4.9974 11.7852 5.07943 11.7305 5.15234L10.9102 5.97266C11.5117 6.90234 11.8125 7.93229 11.8125 9.0625ZM7 10.0469V5.89062C7 5.81771 6.96354 5.74479 6.89062 5.67188C6.83594 5.59896 6.76302 5.5625 6.67188 5.5625H5.57812C5.48698 5.5625 5.40495 5.59896 5.33203 5.67188C5.27734 5.74479 5.25 5.81771 5.25 5.89062V10.0469C5.25 10.138 5.27734 10.2201 5.33203 10.293C5.40495 10.3477 5.48698 10.375 5.57812 10.375H6.67188C6.76302 10.375 6.83594 10.3477 6.89062 10.293C6.96354 10.2201 7 10.138 7 10.0469Z"
                          fill="#FD6060"
                        />
                      </svg>
                      <span class="job-item__time font-5">'.$diff.' hour(s)</span
                      >
                    </li>
                  </ul>
                  <div class="job-item__edit hidden">
                    <button class="job-edit button button-dashboard">edit</button>
                    <button class="job-delete button button-dashboard">delete</button>
                  </div>
                  <div class="job-item__confirm hidden">
                    <p class="font-5">Are you sure to delete it?</p>
                    <div id="delete">
                      <input type="hidden" name="post-edit-id" value="'.$job_id.'"/>
                      <button type="button" class="delete-cancel button button-border">cancel</button>
                      <button class="delete-delete button button-dashboard" id="post-edit__delete" name="delete-job" data-id = "'.$job_id.'" hidden>delete</button>
                    </div>
                  </div>
                </section>
              </section>
            </div>';



      }

  }


  public function getAllCompletedJobs()
  {
      // TODO Organize SELECT from `jobs` and `jobcategories` tables based on completed column


      $db = new Dbh;
      $conn = $db->connect();
      $sql = "SELECT jobs.*,jobcategories.* FROM jobs INNER JOIN jobcategories ON jobs.jobcategoryid = jobcategories.categoryid WHERE completed = '1'";
      $result = $conn->query($sql)->fetchAll();
      foreach ($result as $completed_job) {
          $completed_job_name =$completed_job['jobname'];
          $completed_persons_count = $completed_job['persons'];
          $completed_location = $completed_job['location'];
          $completed_category = $completed_job['category'];
          $completed_timefrom = gmdate("h:i. l, F j",strtotime($completed_job['timefrom']));
          $diff = gmdate("h:i",strtotime($completed_job['timeto'])-strtotime($completed_job['timefrom']));
          $completed_persons_found = $completed_job['persons_found'];

          echo
          '<div class="col-12 col-sm-6	col-md-6 col-lg-4	col-xl-3">
<section class="job-item__wrapper job-item__wrapper--ready">
                <span class="job-item__repeat hidden"
                  ><svg
                    width="10"
                    height="16"
                    viewBox="0 0 10 16"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M3.89167 9.90625V14.8125L4.57917 15.8438C4.6625 15.9479 4.76667 16 4.89167 16C5.01667 16 5.12083 15.9479 5.20417 15.8438L5.89167 14.8125V9.90625C5.5375 9.96875 5.20417 10 4.89167 10C4.57917 10 4.24583 9.96875 3.89167 9.90625ZM4.89167 0C4.07917 0 3.32917 0.208333 2.64167 0.625C1.95417 1.02083 1.40208 1.5625 0.985416 2.25C0.589583 2.9375 0.391666 3.6875 0.391666 4.5C0.391666 5.3125 0.589583 6.0625 0.985416 6.75C1.40208 7.4375 1.95417 7.98958 2.64167 8.40625C3.32917 8.80208 4.07917 9 4.89167 9C5.70417 9 6.45417 8.80208 7.14167 8.40625C7.82917 7.98958 8.37083 7.4375 8.76667 6.75C9.18333 6.0625 9.39167 5.3125 9.39167 4.5C9.39167 3.6875 9.18333 2.9375 8.76667 2.25C8.37083 1.5625 7.82917 1.02083 7.14167 0.625C6.45417 0.208333 5.70417 0 4.89167 0ZM4.89167 2.375C4.30833 2.375 3.80833 2.58333 3.39167 3C2.975 3.41667 2.76667 3.91667 2.76667 4.5C2.76667 4.60417 2.725 4.69792 2.64167 4.78125C2.57917 4.84375 2.49583 4.875 2.39167 4.875C2.2875 4.875 2.19375 4.84375 2.11042 4.78125C2.04792 4.69792 2.01667 4.60417 2.01667 4.5C2.01667 3.70833 2.29792 3.03125 2.86042 2.46875C3.42292 1.90625 4.1 1.625 4.89167 1.625C4.99583 1.625 5.07917 1.66667 5.14167 1.75C5.225 1.8125 5.26667 1.89583 5.26667 2C5.26667 2.10417 5.225 2.19792 5.14167 2.28125C5.07917 2.34375 4.99583 2.375 4.89167 2.375Z"
                      fill="#FD6060"
                    />
                  </svg>
                </span>
                <header>
                  <svg
                    class="job-item__edb"
                    width="15"
                    height="15"
                    viewBox="0 0 15 15"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M14.7823 3.73047C14.7458 3.60286 14.6638 3.52995 14.5362 3.51172C14.4268 3.47526 14.3266 3.5026 14.2354 3.59375L12.1846 5.61719L10.3253 5.31641L10.0245 3.45703L12.0479 1.40625C12.1391 1.3151 12.1664 1.21484 12.1299 1.10547C12.1117 0.977865 12.0388 0.895833 11.9112 0.859375C11.2549 0.695312 10.5896 0.704427 9.9151 0.886719C9.24062 1.06901 8.65729 1.40625 8.1651 1.89844C7.63646 2.42708 7.2901 3.05599 7.12604 3.78516C6.96198 4.51432 6.99844 5.22526 7.23542 5.91797L1.4112 11.7695C1.06484 12.1159 0.891666 12.526 0.891666 13C0.891666 13.4922 1.05573 13.9023 1.38385 14.2305C1.73021 14.5768 2.14036 14.75 2.61432 14.75C3.10651 14.75 3.52578 14.5768 3.87214 14.2305L9.69635 8.40625C10.4073 8.64323 11.1182 8.67969 11.8292 8.51562C12.5583 8.35156 13.1964 8.00521 13.7432 7.47656C14.2354 6.96615 14.5727 6.38281 14.7549 5.72656C14.9372 5.05208 14.9464 4.38672 14.7823 3.73047ZM2.64167 13.6562C2.45937 13.6562 2.30443 13.5924 2.17682 13.4648C2.04922 13.3372 1.98542 13.1823 1.98542 13C1.98542 12.8177 2.04922 12.6628 2.17682 12.5352C2.30443 12.4076 2.45937 12.3438 2.64167 12.3438C2.82396 12.3438 2.97891 12.4076 3.10651 12.5352C3.23411 12.6628 3.29792 12.8177 3.29792 13C3.29792 13.1823 3.23411 13.3372 3.10651 13.4648C2.97891 13.5924 2.82396 13.6562 2.64167 13.6562Z"
                      fill="#FD6060"
                    />
                  </svg>
                  <p class="job-item__title font-7">'.$completed_job_name.'
                  </p>
                  <p class="job-item__id hidden">jobId
                  </p>
                </header>
                <section class="job-item">
                  <ul>
                    <li>
                      <svg
                        width="14"
                        height="15"
                        viewBox="0 0 14 15"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <path
                          d="M12.1836 4.25C11.8737 4.25 11.6094 4.35938 11.3906 4.57812C11.1719 4.79688 11.0625 5.0612 11.0625 5.37109V7.75H10.8438V2.9375C10.8438 2.6276 10.7344 2.36328 10.5156 2.14453C10.2969 1.92578 10.0326 1.81641 9.72266 1.81641C9.43099 1.81641 9.17578 1.92578 8.95703 2.14453C8.75651 2.36328 8.65625 2.61849 8.65625 2.91016V7.75H8.4375V1.87109C8.4375 1.5612 8.32812 1.29688 8.10938 1.07812C7.89062 0.859375 7.6263 0.75 7.31641 0.75C7.02474 0.75 6.76953 0.859375 6.55078 1.07812C6.35026 1.29688 6.25 1.55208 6.25 1.84375V7.75H6.03125V2.96484C6.03125 2.65495 5.92188 2.39062 5.70312 2.17188C5.48438 1.95312 5.22005 1.84375 4.91016 1.84375C4.61849 1.84375 4.36328 1.95312 4.14453 2.17188C3.94401 2.39062 3.84375 2.64583 3.84375 2.9375V9.39062L2.96875 8.1875C2.80469 7.95052 2.56771 7.8138 2.25781 7.77734C1.96615 7.72266 1.69271 7.78646 1.4375 7.96875C1.20052 8.13281 1.05469 8.36979 1 8.67969C0.963542 8.97135 1.03646 9.24479 1.21875 9.5L4.63672 14.2031C4.76432 14.3854 4.91927 14.5221 5.10156 14.6133C5.30208 14.7044 5.5026 14.75 5.70312 14.75H11.1172C11.4089 14.75 11.6732 14.6497 11.9102 14.4492C12.1654 14.2669 12.3203 14.0299 12.375 13.7383L13.1133 10.6484C13.2044 10.2656 13.25 9.86458 13.25 9.44531V5.34375C13.25 5.05208 13.1406 4.79688 12.9219 4.57812C12.7214 4.35938 12.4753 4.25 12.1836 4.25Z"
                          fill="#FD6060"
                        />
                      </svg>
                      <span class="job-item__hand font-5">'.$completed_persons_count.'
                    </span>&nbsp;<span class="font-5">registered: '.$completed_persons_found.'</span>
                    </li>
                    <li>
                      <svg
                        width="18"
                        height="15"
                        viewBox="0 0 18 15"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <path
                          d="M13.6172 6.92969L7.82031 1.13281C7.5651 0.877604 7.25521 0.75 6.89062 0.75H1.3125C0.947917 0.75 0.638021 0.877604 0.382812 1.13281C0.127604 1.38802 0 1.69792 0 2.0625V7.64062C0 8.00521 0.127604 8.3151 0.382812 8.57031L6.17969 14.3672C6.4349 14.6224 6.74479 14.75 7.10938 14.75C7.47396 14.75 7.78385 14.6224 8.03906 14.3672L13.6172 8.78906C13.8724 8.53385 14 8.22396 14 7.85938C14 7.49479 13.8724 7.1849 13.6172 6.92969ZM3.0625 5.125C2.69792 5.125 2.38802 4.9974 2.13281 4.74219C1.8776 4.48698 1.75 4.17708 1.75 3.8125C1.75 3.44792 1.8776 3.13802 2.13281 2.88281C2.38802 2.6276 2.69792 2.5 3.0625 2.5C3.42708 2.5 3.73698 2.6276 3.99219 2.88281C4.2474 3.13802 4.375 3.44792 4.375 3.8125C4.375 4.17708 4.2474 4.48698 3.99219 4.74219C3.73698 4.9974 3.42708 5.125 3.0625 5.125ZM17.1172 8.78906L11.5391 14.3672C11.2839 14.6224 10.974 14.75 10.6094 14.75C10.2448 14.75 9.9349 14.6224 9.67969 14.3672L14.4375 9.60938C14.9115 9.11719 15.1484 8.53385 15.1484 7.85938C15.1484 7.1849 14.9115 6.60156 14.4375 6.10938L9.05078 0.75H10.3906C10.7552 0.75 11.0651 0.877604 11.3203 1.13281L17.1172 6.92969C17.3724 7.1849 17.5 7.49479 17.5 7.85938C17.5 8.22396 17.3724 8.53385 17.1172 8.78906Z"
                          fill="#FD6060"
                        />
                      </svg>
                      <span class="job-item__team font-5">'.$completed_category.'<input name="post-edit-categoryId" class="hidden" value="CategoryId"/></span>
                    </li>
                    <li>
                      <svg
                        width="14"
                        height="15"
                        viewBox="0 0 14 15"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <path
                          d="M7 0.96875C5.77865 0.96875 4.64844 1.27865 3.60938 1.89844C2.57031 2.5 1.74089 3.32031 1.12109 4.35938C0.519531 5.39844 0.21875 6.52865 0.21875 7.75C0.21875 8.97135 0.519531 10.1016 1.12109 11.1406C1.74089 12.1797 2.57031 13 3.60938 13.6016C4.64844 14.2214 5.77865 14.5312 7 14.5312C8.22135 14.5312 9.35156 14.2214 10.3906 13.6016C11.4297 13 12.25 12.1797 12.8516 11.1406C13.4714 10.1016 13.7812 8.97135 13.7812 7.75C13.7812 6.52865 13.4714 5.39844 12.8516 4.35938C12.25 3.32031 11.4297 2.5 10.3906 1.89844C9.35156 1.27865 8.22135 0.96875 7 0.96875ZM8.55859 10.5391L6.15234 8.78906C6.0612 8.71615 6.01562 8.625 6.01562 8.51562V3.92188C6.01562 3.83073 6.04297 3.75781 6.09766 3.70312C6.17057 3.63021 6.2526 3.59375 6.34375 3.59375H7.65625C7.7474 3.59375 7.82031 3.63021 7.875 3.70312C7.94792 3.75781 7.98438 3.83073 7.98438 3.92188V7.69531L9.73438 8.95312C9.80729 9.00781 9.84375 9.08073 9.84375 9.17188C9.86198 9.26302 9.84375 9.34505 9.78906 9.41797L9.02344 10.457C8.96875 10.5299 8.89583 10.5755 8.80469 10.5938C8.71354 10.612 8.63151 10.5938 8.55859 10.5391Z"
                          fill="#FD6060"
                        />
                      </svg>
                      <span class="job-item__date font-5">'.$completed_timefrom.'</span>
                    </li>
                    <li>
                      <svg
                        width="12"
                        height="15"
                        viewBox="0 0 12 15"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <path
                          d="M11.8125 9.0625C11.8125 10.1016 11.5573 11.0586 11.0469 11.9336C10.5365 12.7904 9.84375 13.474 8.96875 13.9844C8.11198 14.4948 7.16406 14.75 6.125 14.75C5.08594 14.75 4.12891 14.4948 3.25391 13.9844C2.39714 13.474 1.71354 12.7904 1.20312 11.9336C0.692708 11.0586 0.4375 10.1016 0.4375 9.0625C0.4375 8.13281 0.647135 7.26693 1.06641 6.46484C1.48568 5.64453 2.0599 4.97005 2.78906 4.44141C3.53646 3.91276 4.35677 3.58464 5.25 3.45703V2.5H4.48438C4.39323 2.5 4.3112 2.47266 4.23828 2.41797C4.18359 2.34505 4.15625 2.26302 4.15625 2.17188V1.07812C4.15625 0.986979 4.18359 0.914062 4.23828 0.859375C4.3112 0.786458 4.39323 0.75 4.48438 0.75H7.76562C7.85677 0.75 7.92969 0.786458 7.98438 0.859375C8.05729 0.914062 8.09375 0.986979 8.09375 1.07812V2.17188C8.09375 2.26302 8.05729 2.34505 7.98438 2.41797C7.92969 2.47266 7.85677 2.5 7.76562 2.5H7V3.42969C8.02083 3.59375 8.93229 4.00391 9.73438 4.66016L10.4727 3.92188C10.5456 3.84896 10.6276 3.8125 10.7188 3.8125C10.8099 3.8125 10.8828 3.84896 10.9375 3.92188L11.7305 4.6875C11.7852 4.74219 11.8125 4.8151 11.8125 4.90625C11.8125 4.9974 11.7852 5.07943 11.7305 5.15234L10.9102 5.97266C11.5117 6.90234 11.8125 7.93229 11.8125 9.0625ZM7 10.0469V5.89062C7 5.81771 6.96354 5.74479 6.89062 5.67188C6.83594 5.59896 6.76302 5.5625 6.67188 5.5625H5.57812C5.48698 5.5625 5.40495 5.59896 5.33203 5.67188C5.27734 5.74479 5.25 5.81771 5.25 5.89062V10.0469C5.25 10.138 5.27734 10.2201 5.33203 10.293C5.40495 10.3477 5.48698 10.375 5.57812 10.375H6.67188C6.76302 10.375 6.83594 10.3477 6.89062 10.293C6.96354 10.2201 7 10.138 7 10.0469Z"
                          fill="#FD6060"
                        />
                      </svg>
                      <span class="job-item__time font-5" data-from="1:00" data-to="2:15">'.$diff.' hour(s).</span
                      >
                    </li>
                  </ul>
                  <div class="job-item__edit hidden">
                    <input type="hidden" name="post-edit-id" value="jobId"/>
                    <button class="repostJob button button-dashboard"  name="repost-job">repost it</button>
                  </div>
                </section>
              </section></div> ';

      }
  }
}
